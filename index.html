<html>
<head>
<script src='https://unpkg.com/xrpl@2.1.0-beta.1'></script>
<script>
if (typeof module !== "undefined") var xrpl = require('xrpl')

//***************************
//** Mint Token *************
//***************************


const mintTokens = async () => {
    // this will come from the json on ipfs://
    const data = [
        {
          name: "DedAstronauts #42",
          description: "They ded",
          image: "QmejZCt4xD7tJKAt1qw34PkTDEyM4uvzQa4FjfUvmC9ort/42.png",
          dna: "8ecc5a068a30f1dbc7248d8ae4ab0809e7ee7c09",
          edition: 42,
          date: 1643449552271,
          attributes: [
            {
              trait_type: "Backgrounds",
              value: "Yellow",
            },
            {
              trait_type: "Frame",
              value: "Frame",
            },
            {
              trait_type: "Suit",
              value: "Blue",
            },
            {
              trait_type: "Cables",
              value: "Pink",
            },
            {
              trait_type: "Helmet",
              value: "Pink",
            },
            {
              trait_type: "Visor",
              value: "Common",
            },
            {
              trait_type: "Body",
              value: "Outline",
            },
            {
              trait_type: "Monitor",
              value: "common",
            },
          ],
          compiler: "HashLips Art Engine",
        },
        {
          name: "DedAstronauts #15",
          description: "They ded",
          image: "QmejZCt4xD7tJKAt1qw34PkTDEyM4uvzQa4FjfUvmC9ort/15.png",
          dna: "ebf622d82db2a0727d52e81818d442fa90e47c18",
          edition: 15,
          date: 1643449552327,
          attributes: [
            {
              trait_type: "Backgrounds",
              value: "Yellow",
            },
            {
              trait_type: "Frame",
              value: "Frame",
            },
            {
              trait_type: "Suit",
              value: "Pink",
            },
            {
              trait_type: "Cables",
              value: "Common",
            },
            {
              trait_type: "Helmet",
              value: "Blue",
            },
            {
              trait_type: "Visor",
              value: "Common",
            },
            {
              trait_type: "Body",
              value: "Outline",
            },
            {
              trait_type: "Monitor",
              value: "common",
            },
          ],
          compiler: "HashLips Art Engine",
        },
        {
          name: "DedAstronauts #51",
          description: "They ded",
          image: "QmejZCt4xD7tJKAt1qw34PkTDEyM4uvzQa4FjfUvmC9ort/51.png",
          dna: "f1eac1cf1dfa55f86d9ae016b661aa23f7f44e1a",
          edition: 51,
          date: 1643449552375,
          attributes: [
            {
              trait_type: "Backgrounds",
              value: "Yellow",
            },
            {
              trait_type: "Frame",
              value: "Frame",
            },
            {
              trait_type: "Suit",
              value: "Common",
            },
            {
              trait_type: "Cables",
              value: "Common",
            },
            {
              trait_type: "Helmet",
              value: "Pink",
            },
            {
              trait_type: "Visor",
              value: "Common",
            },
            {
              trait_type: "Body",
              value: "Outline",
            },
            {
              trait_type: "Monitor",
              value: "common",
            },
          ],
          compiler: "HashLips Art Engine",
        }]
        // Transform objects into what the xrpl needs for a payload
    const transformed = data.map((nft) => {
  return {
    TransactionType: "NFTokenMint",
    Account: "rfuzxnijibqiXzS3kccQ4ad3otjUYsrRJj",
    URI: xrpl.convertStringToHex(nft.image),
    Flags:8,
    TokenTaxon: 0, //Required, but if you have no use for it, set to zero.
  };
});

    for (const nft of transformed) {
        console.log(nft)
        const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")
    const payload = {
        TransactionType: "NFTokenMint",
        Account: wallet.classicAddress,
        URI: nft.URI,
        Flags: 8,
        TokenTaxon: 0
    }
    console.log('this is payload: ', payload)
    const tx = await client.submitAndWait(payload,{wallet})
    console.log(tx)
    client.disconnect()
    }


}


async function mintToken() {
	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

	// Note that you must convert the token URL to a hexadecimal
	// value for this transaction.
	// ----------------------------------------------------------
	const transactionBlob = {
		TransactionType: "NFTokenMint",
		Account: wallet.classicAddress,
		URI: xrpl.convertStringToHex(tokenUrl.value),
		Flags: parseInt(flags.value),
		TokenTaxon: 0 //Required, but if you have no use for it, set to zero.
	}
	// Submit signed blob --------------------------------------------------------
	const tx = await client.submitAndWait(transactionBlob,{wallet})

	const nfts = await client.request({
		method: "account_nfts",
		account: wallet.classicAddress
	})
	console.log(nfts)

	// Check transaction results -------------------------------------------------
	console.log("Transaction result:", tx.result.meta.TransactionResult)
	console.log("Balance changes:",
	  JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
	client.disconnect()
} //End of mintToken

//***************************
//** Get Tokens *************
//***************************

async function getTokens() {
	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")
	const nfts = await client.request({
		method: "account_nfts",
		account: wallet.classicAddress
	})
	console.log(nfts)
	client.disconnect()
} //End of getTokens

//***************************
//** Burn Token *************
//***************************

async function burnToken() {
  const wallet = xrpl.Wallet.fromSeed(secret.value)
  const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
  await client.connect()
  console.log("Connected to Sandbox")

  // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      "TransactionType": "NFTokenBurn",
      "Account": wallet.classicAddress,
      "TokenID": tokenId.value
  }

  // Submit signed blob --------------------------------------------------------
  const tx = await client.submitAndWait(transactionBlob,{wallet})
  const nfts = await client.request({
	method: "account_nfts",
	account: wallet.classicAddress
  })
  console.log(nfts)
  // Check transaction results -------------------------------------------------
  console.log("Transaction result:", tx.result.meta.TransactionResult)
  console.log("Balance changes:",
    JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
  client.disconnect()
}
// End of burnToken()

//********************************
//** Create Sell Offer ***********
//********************************

async function createSellOffer() {
	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

 // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      	"TransactionType": "NFTokenCreateOffer",
      	"Account": wallet.classicAddress,
      	"TokenID": tokenId.value,
      	"Amount": amount.value,
      	"Flags": parseInt(flags.value)
  }

  // Submit signed blob --------------------------------------------------------

  const tx = await client.submitAndWait(transactionBlob,{wallet})//AndWait


  console.log("***Sell Offers***")
  let nftSellOffers
    try {
	    nftSellOffers = await client.request({
		method: "nft_sell_offers",
		tokenid: tokenId.value
	  })
	  } catch (err) {
	    console.log("No sell offers.")
	}
  console.log(JSON.stringify(nftSellOffers,null,2))
  console.log("***Buy Offers***")
  let nftBuyOffers
  try {
    nftBuyOffers = await client.request({
	method: "nft_buy_offers",
	tokenid: tokenId.value })
  } catch (err) {
    console.log("No buy offers.")
  }
  console.log(JSON.stringify(nftBuyOffers,null,2))

  // Check transaction results -------------------------------------------------
  console.log("Transaction result:",
    JSON.stringify(tx.result.meta.TransactionResult, null, 2))
  console.log("Balance changes:",
    JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
  client.disconnect()
  // End of createSellOffer()
}
//********************************
//** Create Buy Offer ***********
//********************************

async function createBuyOffer() {

	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

 // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      	"TransactionType": "NFTokenCreateOffer",
      	"Account": wallet.classicAddress,
      	"Owner": owner.value,
      	"TokenID": tokenId.value,
      	"Amount": amount.value,
      	"Flags": parseInt(flags.value)
  }

  // Submit signed blob --------------------------------------------------------
  const tx = await client.submitAndWait(transactionBlob,{wallet})

  console.log("***Sell Offers***")
  let nftSellOffers
    try {
	    nftSellOffers = await client.request({
		method: "nft_sell_offers",
		tokenid: tokenId.value
	  })
	  } catch (err) {
	    console.log("No sell offers.")
	}
  console.log(JSON.stringify(nftSellOffers,null,2))
  console.log("***Buy Offers***")
  let nftBuyOffers
  try {
    nftBuyOffers = await client.request({
	method: "nft_buy_offers",
	tokenid: tokenId.value })
  } catch (err) {
    console.log("No buy offers.")
  }
  console.log(JSON.stringify(nftBuyOffers,null,2))


  // Check transaction results -------------------------------------------------
  console.log("Transaction result:",
    JSON.stringify(tx.result.meta.TransactionResult, null, 2))
  console.log("Balance changes:",
    JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
  client.disconnect()
  // End of createBuyOffer()
}

//***************************
//** Cancel Offer ***********
//***************************

async function cancelOffer() {

	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

	const tokenID = tokenOfferIndex.value
	const tokenIDs = [tokenID]

 // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      	"TransactionType": "NFTokenCancelOffer",
      	"Account": wallet.classicAddress,
      	"TokenIDs": tokenIDs
  }

  // Submit signed blob --------------------------------------------------------
  const tx = await client.submitAndWait(transactionBlob,{wallet})


  console.log("***Sell Offers***")
  let nftSellOffers
    try {
	    nftSellOffers = await client.request({
		method: "nft_sell_offers",
		tokenid: tokenId.value
	  })
	  } catch (err) {
	    console.log("No sell offers.")
	}
  console.log(JSON.stringify(nftSellOffers,null,2))
  console.log("***Buy Offers***")
  let nftBuyOffers
  try {
    nftBuyOffers = await client.request({
	method: "nft_buy_offers",
	tokenid: tokenId.value })
  } catch (err) {
    console.log("No buy offers.")
  }
  console.log(JSON.stringify(nftBuyOffers,null,2))

  // Check transaction results -------------------------------------------------

  console.log("Transaction result:",
    JSON.stringify(tx.result.meta.TransactionResult, null, 2))
  console.log("Balance changes:",
    JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))

  client.disconnect()
  // End of cancelOffer()
}
//***************************
//** Get Offers *************
//***************************

async function getOffers() {

	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")
    console.log("***Sell Offers***")
    let nftSellOffers
      try {
	    nftSellOffers = await client.request({
		method: "nft_sell_offers",
		tokenid: tokenId.value
	  })
	  } catch (err) {
	    console.log("No sell offers.")
	}
    console.log(JSON.stringify(nftSellOffers,null,2))
    console.log("***Buy Offers***")
    let nftBuyOffers
    try {
      nftBuyOffers = await client.request({
  	  method: "nft_buy_offers",
	  tokenid: tokenId.value })
    } catch (err) {
      console.log("No buy offers.")
  }
  console.log(JSON.stringify(nftBuyOffers,null,2))
  client.disconnect()
  // End of getOffers()
}
//***************************
//** Accept Sell Offer ******
//***************************

async function acceptSellOffer() {

	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

 // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      	"TransactionType": "NFTokenAcceptOffer",
      	"Account": wallet.classicAddress,
      	"SellOffer": tokenOfferIndex.value,
  }
  // Submit signed blob --------------------------------------------------------
  const tx = await client.submitAndWait(transactionBlob,{wallet})
  const nfts = await client.request({
	method: "account_nfts",
	account: wallet.classicAddress
  })
  console.log(JSON.stringify(nfts,null,2))

  // Check transaction results -------------------------------------------------
  console.log("Transaction result:",
    JSON.stringify(tx.result.meta.TransactionResult, null, 2))
  console.log("Balance changes:",
    JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
  client.disconnect()
  // End of acceptSellOffer()
}
//***************************
//** Accept Buy Offer ******
//***************************

async function acceptBuyOffer() {

	const wallet = xrpl.Wallet.fromSeed(secret.value)
	const client = new xrpl.Client("wss://xls20-sandbox.rippletest.net:51233")
	await client.connect()
	console.log("Connected to Sandbox")

 // Prepare transaction -------------------------------------------------------
  const transactionBlob = {
      	"TransactionType": "NFTokenAcceptOffer",
      	"Account": wallet.classicAddress,
      	"BuyOffer": tokenOfferIndex.value
  }
  // Submit signed blob --------------------------------------------------------
  const tx = await client.submitAndWait(transactionBlob,{wallet})
  const nfts = await client.request({
	method: "account_nfts",
	account: wallet.classicAddress
  })
  console.log(JSON.stringify(nfts,null,2))

  // Check transaction results -------------------------------------------------
  console.log("Transaction result:",
      JSON.stringify(tx.result.meta.TransactionResult, null, 2))
  console.log("Balance changes:",
      JSON.stringify(xrpl.getBalanceChanges(tx.result.meta), null, 2))
  client.disconnect()
  // End of submitTransaction()
}
</script>

<title>NFToken Tester</title>
</head>
<body>
<h1>NFToken Tester</h1>
<form id="theForm">
<p>
<button type="button" onClick="mintToken()">Mint Token</button>&nbsp;&nbsp;
<button type="button" onClick="mintTokens()">Mint Multiple NFTs</button>&nbsp;&nbsp;
<button type="button" onClick="getTokens()">Get Tokens</button>&nbsp;&nbsp;
<button type="button" onClick="burnToken()">Burn Token</button>&nbsp;&nbsp;
</p>
<p>
<button type="button" onClick="createSellOffer()">Create Sell Offer</button>&nbsp;&nbsp;
<button type="button" onClick="createBuyOffer()">Create Buy Offer</button>&nbsp;&nbsp;
<button type="button" onClick="getOffers()">Get Offers</button>
</p>
<p>
<button type="button" onClick="acceptSellOffer()">Accept Sell Offer</button>&nbsp;&nbsp;
<button type="button" onClick="acceptBuyOffer()">Accept Buy Offer</button>&nbsp;&nbsp;
<button type="button" onClick="cancelOffer()">Cancel Offer</button>&nbsp;&nbsp;
</p>
<table>
  <tr>
    <td align="right">Account</td>
    <td><input type="text" id="account" value="rfuzxnijibqiXzS3kccQ4ad3otjUYsrRJj" size="40" /></td>
  </tr>
  <tr>
    <td align="right">Secret</td>
    <td><input type="text" id="secret" value="ssSWELNDJJYW9oBdBexWHdXfk1TP3" size="40" /></td>
  </tr>
  <tr>
    <td align="right">Token URL</td>
    <td><input type="text" id="tokenUrl"
value = "ipfs://bafybeigdyrzt5sfp7udm7hu76uh7y26nf4dfuylqabf3oclgtqy55fbzdi" size="80"/>
    </td>
  </tr>
  <tr>
    <td align="right">Flags</td>
    <td><input type="text" id="flags" value="1" size="10"/></td>
  </tr>
  <tr>
    <td align="right">Token ID</td>
    <td><input type="text" id="tokenId" value="" size="80"/></td>
  </tr>
  <tr>
    <td align="right">Amount</td>
    <td><input type="text" id="amount" value="1000000" size="20"/></td>
  </tr>
  <tr>
    <td align="right">Token Offer Index</td>
    <td><input type="text" id="tokenOfferIndex" value="" size="80"/></td>
  </tr>
  <tr>
    <td align="right">Owner</td>
    <td><input type="text" id="owner" value="" size="80"/></td>
  </tr>
</table>
</form>
</body>
</html>